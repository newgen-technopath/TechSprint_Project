<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dost Financial | Strategic Blueprint</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #121212;
            --card-glass: rgba(30, 30, 30, 0.6);
            --neon-green: #39FF14;
            --neon-blue: #39e5ff;
            --text-white: #ffffff;
            --text-silver: #e0e0e0;
            --text-grey: #a0a0a0;
            --border-light: rgba(255, 255, 255, 0.1);
        }

        body {
            background-color: var(--bg-dark); color: var(--text-white);
            font-family: 'Space Grotesk', sans-serif; height: 100vh; overflow-y: auto;
        }

        .blueprint-container { max-width: 800px; margin: 50px auto; padding-bottom: 100px; }
        
        .status-badge { 
            background: rgba(57, 255, 20, 0.1); color: var(--neon-green); 
            border: 1px solid var(--neon-green); padding: 5px 15px; 
            border-radius: 20px; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px;
        }

        .paper-card {
            background: #1a1a1a; border: 1px solid var(--border-light);
            border-radius: 12px; padding: 40px; margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); position: relative;
        }
        .paper-card::before {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: linear-gradient(90deg, var(--neon-green), var(--neon-blue));
        }

        .roadmap-intro {
            color: var(--neon-green); font-size: 0.9rem; font-style: italic;
            border-left: 2px solid var(--neon-green); padding-left: 15px; margin-bottom: 30px;
            opacity: 0.8;
        }

        .step-row { display: flex; gap: 20px; margin-bottom: 35px; align-items: flex-start; }
        
        .step-check { 
            background: rgba(57, 255, 20, 0.15); /* Subtle Green BG */
            color: var(--neon-green); 
            border: 1px solid var(--neon-green);
            width: 32px; height: 32px; 
            border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            font-weight: bold; flex-shrink: 0;
            font-size: 1.1rem;
            box-shadow: 0 0 8px rgba(57, 255, 20, 0.2); 
        }
        
        .step-content h5 { margin-bottom: 8px; font-weight: bold; font-size: 1.1rem; color: #fff; letter-spacing: 0.5px; }
        .step-content p { color: var(--text-silver); font-size: 1.1rem; line-height: 1.6; margin: 0; }

        /* Action Bar Styles */
        .action-bar {
            margin-top: 40px; text-align: center; display: flex; gap: 15px; justify-content: center;
        }
        .btn-outline {
            border: 1px solid var(--border-light); color: var(--text-grey);
            padding: 10px 25px; border-radius: 30px; background: transparent; transition: all 0.3s;
        }
        .btn-outline:hover { border-color: #fff; color: #fff; }
        
        .btn-print {
            background: var(--neon-green); color: #000; font-weight: bold;
            padding: 10px 30px; border-radius: 30px; border: none; 
            box-shadow: 0 0 10px rgba(57, 255, 20, 0.2); transition: all 0.3s;
        }
        .btn-print:hover { box-shadow: 0 0 20px rgba(57, 255, 20, 0.4); transform: translateY(-2px); }

        /* Active Dost Mode Style */
        .btn-outline.active-dost {
            border-color: var(--neon-green);
            color: var(--neon-green);
            box-shadow: 0 0 10px rgba(57, 255, 20, 0.2);
        }

        /* Hide buttons when printing */
        @media print {
            .action-bar { display: none; }
            body { background-color: #fff; color: #000; }
            .paper-card { border: 1px solid #000; box-shadow: none; color: #000; background: #fff; }
            .step-content p { color: #333; }
            .fw-bold.text-white { color: #000 !important; }
        }
    </style>
</head>
<body>

<div class="blueprint-container">
    
    <div class="text-center">
        <span class="status-badge">Strategy Locked üîí</span>
        <h1 class="fw-bold mt-3 mb-2">Your Financial Blueprint</h1>
        <p class="text-grey">Generated by Dost AI Engine ‚Ä¢ <span id="current-date"></span></p>
    </div>

    <div class="paper-card">
        <div class="d-flex justify-content-between align-items-center mb-4 pb-3 border-bottom border-secondary">
            <div>
                <small class="text-grey text-uppercase">Selected Strategy</small>
                <h2 class="fw-bold text-white mb-0" id="plan-title">Loading...</h2>
            </div>
            <div class="text-end">
                <small class="text-grey text-uppercase">Focus</small>
                <div class="fw-bold text-neon" id="plan-focus">Loading...</div>
            </div>
        </div>

        <div class="roadmap-intro" id="roadmap-intro-text">
            Operational Roadmap: Execute the following directives in sequential order to secure your financial target.
        </div>

        <div id="steps-container">
            </div>

        <div class="mt-5 p-3 rounded" style="background: rgba(57, 255, 20, 0.05); border: 1px solid rgba(57, 255, 20, 0.2);">
            <div class="row text-center">
                <div class="col-6 border-end border-secondary">
                    <small class="text-grey">Monthly Debt Payoff</small>
                    <h4 class="fw-bold text-white mb-0" id="stat-debt">‚Çπ0</h4>
                </div>
                <div class="col-6">
                    <small class="text-grey">Monthly Investment</small>
                    <h4 class="fw-bold text-white mb-0" id="stat-invest">‚Çπ0</h4>
                </div>
            </div>
        </div>
    </div>

    <div class="action-bar">
        <button class="btn-outline" onclick="window.location.href='/'">‚Üê New Strategy</button>
        <button class="btn-outline" onclick="toggleLanguage()" id="btn-lang">üáÆüá≥ Dost Mode</button>
        <button class="btn-print" onclick="window.print()">üñ®Ô∏è Print / Save PDF</button>
    </div>

</div>

<script>
    // GLOBAL STATE
    let isTranslated = false;
    let originalPlan = null; // Stores the English version
    let planType = null;     // 'aggressive' or 'balanced'

    window.onload = function() {
        // 1. Retrieve data
        const rawData = localStorage.getItem('dost_report_data');
        if (!rawData) {
            alert("No plan found. Redirecting to home.");
            window.location.href = '/';
            return;
        }

        const data = JSON.parse(rawData);
        originalPlan = data.chosenPlan;
        planType = data.type;
        
        // 2. Render Initial (English) Plan
        renderPlan(originalPlan, planType);
    };

    // REUSABLE RENDER FUNCTION
    function renderPlan(plan, type) {
        document.getElementById('current-date').innerText = new Date().toLocaleDateString();
        document.getElementById('plan-title').innerText = plan.title;
        document.getElementById('plan-focus').innerText = type === 'aggressive' ? 'SPEED ‚ö°' : 'GROWTH üå±';

        // Optional: Translate Intro Text based on title detection (simple heuristic)
        const intro = document.getElementById('roadmap-intro-text');
        if (isTranslated) {
            intro.innerText = "Bhai, ye raha tera solid plan. Ise follow kar aur life set kar le:";
        } else {
            intro.innerText = "Operational Roadmap: Execute the following directives in sequential order to secure your financial target.";
        }

        const stepsContainer = document.getElementById('steps-container');
        stepsContainer.innerHTML = ''; // Clear existing
        
        if (plan.steps) {
            plan.steps.forEach((step, index) => {
                const num = (index + 1).toString().padStart(2, '0');
                stepsContainer.innerHTML += `
                    <div class="step-row">
                        <div class="step-check">‚úì</div>
                        <div class="step-content">
                            <h5>Strategic Directive ${num}</h5>
                            <p>${step}</p>
                        </div>
                    </div>
                `;
            });
        }

        // Financials never change translation, just formatting
        const alloc = plan.allocation;
        document.getElementById('stat-debt').innerText = '+‚Çπ' + alloc.extra_debt.toLocaleString('en-IN');
        document.getElementById('stat-invest').innerText = '‚Çπ' + alloc.invest.toLocaleString('en-IN');
    }

    // DOST MODE LOGIC
    async function toggleLanguage() {
        const btn = document.getElementById('btn-lang');
        
        // A. REVERT TO ENGLISH
        if (isTranslated) {
            isTranslated = false;
            renderPlan(originalPlan, planType);
            
            btn.innerText = "üáÆüá≥ Dost Mode";
            btn.classList.remove('active-dost');
            return;
        }

        // B. SWITCH TO HINGLISH
        const originalText = btn.innerText;
        btn.innerText = "Translating...";
        btn.disabled = true;

        try {
            const response = await fetch('/api/translate-plan', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    plan: originalPlan, 
                    language: 'Hinglish' 
                })
            });
            
            const translatedPlan = await response.json();
            
            if (translatedPlan.error) throw new Error(translatedPlan.error);

            isTranslated = true;
            renderPlan(translatedPlan, planType);
            
            btn.innerText = "üá∫üá∏ English Mode";
            btn.classList.add('active-dost');
            
        } catch (e) {
            console.error(e);
            alert("Translation failed. Check console.");
            btn.innerText = originalText;
        } finally {
            btn.disabled = false;
        }
    }
</script>

</body>
</html>